<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bijtelling Test - v1.11 (Restored)</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .test-result {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #4ade80;
        }
        .test-error {
            border-left-color: #ef4444;
        }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        button {
            background: #4ade80;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
        }
        button:hover {
            background: #22c55e;
        }
        .status {
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 6px;
            display: inline-block;
            margin: 5px 0;
        }
        .status.success { background: #22c55e; }
        .status.error { background: #ef4444; }
        .status.warning { background: #f59e0b; }
        .status.info { background: #3b82f6; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Bijtelling Test - v1.11 (Restored)</h1>
        <p>✅ Teruggezet naar stabiele v1.11 zonder 60-maanden complexity</p>
        
        <div class="test-controls">
            <button onclick="testTeslaK693BS()">🚗 Test Tesla K693BS</button>
            <button onclick="testSimpleBijtelling()">📊 Test Eenvoudige Bijtelling</button>
            <button onclick="clearResults()">🗑️ Clear Results</button>
        </div>
        
        <div id="results"></div>
    </div>

    <!-- Include RDW API -->
    <script src="/assets/js/rdw-api.js"></script>
    
    <script>
        const resultsDiv = document.getElementById('results');
        
        function addResult(title, content, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type === 'error' ? 'test-error' : ''}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <div class="status ${type}">${type.toUpperCase()}</div>
                <pre>${typeof content === 'object' ? JSON.stringify(content, null, 2) : content}</pre>
            `;
            resultsDiv.appendChild(div);
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        async function testTeslaK693BS() {
            addResult('🚀 Testing Tesla K693BS', 'Using restored v1.11 API...', 'info');
            
            try {
                const rdwApi = new RDWApi();
                const vehicleData = await rdwApi.getVehicleData('K693BS');
                
                if (!vehicleData) {
                    addResult('❌ RDW Data Failed', 'No vehicle data returned', 'error');
                    return;
                }
                
                addResult('✅ RDW Data Retrieved', `
Basic Info:
- Kenteken: ${vehicleData.kenteken}
- Merk: ${vehicleData.merk}
- Model: ${vehicleData.handelsbenaming}
- Bouwjaar: ${vehicleData.bouwjaar}
- Brandstof: ${vehicleData.brandstof}
- Elektrisch: ${vehicleData.isElektrisch}
- Catalogusprijs: €${vehicleData.catalogusprijs?.toLocaleString()}
                `, 'success');
                
                addResult('📊 Bijtelling Berekening', `
Bijtelling Percentage: ${vehicleData.bijtellingspercentage}%
Basis: Vereenvoudigde v1.11 regels
Status: Geen 60-maanden complexity
                `, vehicleData.bijtellingspercentage ? 'success' : 'warning');
                
                addResult('📋 Complete Vehicle Data', vehicleData, 'info');
                
            } catch (error) {
                addResult('❌ Test Failed', `Error: ${error.message}`, 'error');
            }
        }
        
        async function testSimpleBijtelling() {
            addResult('🧮 Testing Simple Bijtelling Logic', 'Testing verschiedene scenario\'s...', 'info');
            
            // Simuleer verschillende auto scenarios
            const testCases = [
                {
                    beschrijving: 'Tesla 2020 €40.000',
                    data: { merk: 'TESLA', brandstof_omschrijving: 'Elektriciteit', catalogusprijs: '40000', datum_eerste_toelating: '2020-06-15' },
                    verwacht: 22
                },
                {
                    beschrijving: 'Elektrisch 2023 €25.000',
                    data: { merk: 'NISSAN', brandstof_omschrijving: 'Elektriciteit', catalogusprijs: '25000', datum_eerste_toelating: '2023-03-01' },
                    verwacht: 17
                },
                {
                    beschrijving: 'Benzine 2020',
                    data: { merk: 'VOLKSWAGEN', brandstof_omschrijving: 'Benzine', catalogusprijs: '30000', datum_eerste_toelating: '2020-01-01' },
                    verwacht: 22
                },
                {
                    beschrijving: 'Pre-2017 auto',
                    data: { merk: 'BMW', brandstof_omschrijving: 'Benzine', catalogusprijs: '35000', datum_eerste_toelating: '2015-05-01' },
                    verwacht: 25
                }
            ];
            
            const rdwApi = new RDWApi();
            
            for (const testCase of testCases) {
                const isYoungtimer = false; // Vereenvoudigd
                const result = rdwApi.calculateSimpleBijtelling(testCase.data, isYoungtimer);
                
                const isCorrect = result === testCase.verwacht;
                
                addResult(`${isCorrect ? '✅' : '❌'} ${testCase.beschrijving}`, `
Verwacht: ${testCase.verwacht}%
Resultaat: ${result}%
Status: ${isCorrect ? 'CORRECT' : 'INCORRECT'}
                `, isCorrect ? 'success' : 'error');
            }
        }
        
        // Auto-run basic test
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('🚀 v1.11 Restored Successfully', 'Simplified bijtelling without 60-months complexity', 'success');
                testSimpleBijtelling();
            }, 500);
        });
    </script>
</body>
</html>